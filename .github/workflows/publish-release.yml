name: Publish Lume Beta Release

on:
  push:
    tags:
      - 'v*.*.*-beta*'  # Padrão para versões beta (ex: v1.0.0-beta1, v1.0.0-beta.2)

jobs:
  build-and-publish:
    runs-on: ubuntu-latest
    
    steps:
      # [Etapas 1-4 mantidas iguais ao original...]
      
      # 5. Create beta release info
      - name: Create release info
        run: |
          TAG_VERSION=$(echo '${{ github.ref_name }}' | sed 's/v//')
          CURRENT_DATE=$(date +'%Y-%m-%d')
          
          echo '{
            "version": "'$TAG_VERSION'",
            "buildNumber": "'$GITHUB_RUN_NUMBER'",
            "title": "Lume BETA $TAG_VERSION",
            "description": "Primeira versão beta - recursos em teste",
            "downloadUrl": "https://github.com/Drew005/Lume/releases/download/${{ github.ref_name }}/lume.apk",
            "isForced": false,
            "releaseDate": "'$CURRENT_DATE'",
            "features": [
              "Versão beta inicial",
              "Funcionalidades principais em teste",
              "Sistema de atualização integrado"
            ],
            "improvements": [
              "Estrutura básica estabelecida",
              "Fluxo principal funcional"
            ],
            "bugFixes": [
              "Problemas críticos resolvidos para o beta"
            ],
            "isBeta": true  # Novo campo para identificar versões beta
          }' > releases/versions/${{ github.ref_name }}/info.json
          
      # 6. Update latest version pointer
      - name: Update latest version pointer
        run: |
          echo '{
            "version": "'$(echo '${{ github.ref_name }}' | sed 's/v//')'",
            "url": "https://raw.githubusercontent.com/Drew005/Lume/main/releases/versions/${{ github.ref_name }}/info.json"
          }' > releases/latest.json
          
      # 7. Create GitHub Release
      - name: Create GitHub Release
        uses: softprops/action-gh-release@v1
        with:
          files: |
            releases/versions/${{ github.ref_name }}/lume.apk
            releases/versions/${{ github.ref_name }}/info.json
          tag_name: ${{ github.ref_name }}
          body: |
            ## Novidades na versão ${{ github.ref_name }}
            
            ### Novos Recursos
            - Novo design da interface
            - Suporte a temas escuros
            - Nova funcionalidade X
            
            ### Melhorias
            - Melhor desempenho na navegação
            - Otimização de uso de memória
            
            ### Correções
            - Corrigido crash ao abrir configurações
            - Resolvido problema de sincronização